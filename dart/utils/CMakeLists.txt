#------------------------------------------------------------------------------
# Include source and build directories
#------------------------------------------------------------------------------
include_directories(
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_CURRENT_BINARY_DIR}
)

#------------------------------------------------------------------------------
# Configure module header files
#------------------------------------------------------------------------------
# Set unique vars used in the autogenerated config file (symbol import/export)
if(BUILD_SHARED_LIBS)
  set(DART_UTILS_BUILD_SHARED_LIBS 1)
  set(DART_UTILS_LIBTYPE SHARED)
else()
  set(DART_UTILS_BUILD_SHARED_LIBS 0)
  set(DART_UTILS_LIBTYPE STATIC)
endif()

configure_file(
  ${CMAKE_CURRENT_SOURCE_DIR}/dart_config.h.in
  ${CMAKE_CURRENT_BINARY_DIR}/dart_config.h
)

#------------------------------------------------------------------------------
# Set sources
#------------------------------------------------------------------------------


set(DART_UTILS_UTILS_SRC
    ${CMAKE_CURRENT_SOURCE_DIR}/string_utils.c
    ${CMAKE_CURRENT_SOURCE_DIR}/query_utils.c
    ${CMAKE_CURRENT_SOURCE_DIR}/timer_utils.c
    ${CMAKE_CURRENT_SOURCE_DIR}/hashset.c
    ${CMAKE_CURRENT_SOURCE_DIR}/vector.c
    ${CMAKE_CURRENT_SOURCE_DIR}/art.c
    )

#------------------------------------------------------------------------------
# Libraries
#------------------------------------------------------------------------------
# DART_UTILS
add_library(dart_utils ${DART_UTILS_SRC})
dart_set_lib_options(dart_utils "dart_utils" ${DART_UTILS_LIBTYPE})

# DART
add_library(dart_utils ${DART_UTILS_SRCS})

set(DART_UTILS_EXPORTED_LIBS dart_utils ${DART_UTILS_EXPORTED_LIBS})

#-----------------------------------------------------------------------------
# Specify project header files to be installed
#-----------------------------------------------------------------------------

set(DART_UTILS_UTILS_HEADERS
  ${CMAKE_CURRENT_SOURCE_DIR}/string_utils.h
  ${CMAKE_CURRENT_SOURCE_DIR}/query_utils.h
  ${CMAKE_CURRENT_SOURCE_DIR}/timer_utils.h
  ${CMAKE_CURRENT_SOURCE_DIR}/vector.h
  ${CMAKE_CURRENT_SOURCE_DIR}/hashset.h
  ${CMAKE_CURRENT_SOURCE_DIR}/art.h
)
#-----------------------------------------------------------------------------
# Add file(s) to CMake Install
#-----------------------------------------------------------------------------


install(
  FILES
    ${DART_UTILS_HEADERS}
  DESTINATION
    ${DART_UTILS_INSTALL_INCLUDE_DIR}
  COMPONENT
    headers
)

install(
  FILES
    ${DART_UTILS_HL_HEADERS}
  DESTINATION
    ${DART_UTILS_INSTALL_INCLUDE_DIR}
  COMPONENT
    headers
)

#-----------------------------------------------------------------------------
# Add Target(s) to CMake Install
#-----------------------------------------------------------------------------

install(
  TARGETS
    dart_utils
  EXPORT
    ${DART_UTILS_EXPORTED_TARGETS}
  LIBRARY DESTINATION ${DART_UTILS_INSTALL_LIB_DIR}
  ARCHIVE DESTINATION ${DART_UTILS_INSTALL_LIB_DIR}
  RUNTIME DESTINATION ${DART_UTILS_INSTALL_BIN_DIR}
)

install(
  TARGETS
    dart
  EXPORT
    ${DART_UTILS_EXPORTED_TARGETS}
  LIBRARY DESTINATION ${DART_UTILS_INSTALL_LIB_DIR}
  ARCHIVE DESTINATION ${DART_UTILS_INSTALL_LIB_DIR}
  RUNTIME DESTINATION ${DART_UTILS_INSTALL_BIN_DIR}
)

#-----------------------------------------------------------------------------
# Add Target(s) to CMake Install for import into other projects
#-----------------------------------------------------------------------------
install(
  EXPORT
    ${DART_UTILS_EXPORTED_TARGETS}
  DESTINATION
    ${DART_UTILS_INSTALL_DATA_DIR}/cmake/dart
  FILE
    ${DART_UTILS_EXPORTED_TARGETS}.cmake
)

#-----------------------------------------------------------------------------
# Export all exported targets to the build tree for use by parent project
#-----------------------------------------------------------------------------
if(NOT DART_UTILS_EXTERNALLY_CONFIGURED)
EXPORT (
  TARGETS
    ${DART_UTILS_EXPORTED_LIBS}
  FILE
    ${DART_UTILS_EXPORTED_TARGETS}.cmake
)
endif()

#------------------------------------------------------------------------------
# Set variables for parent scope
#------------------------------------------------------------------------------
# Used by config.cmake.build.in and Testing
set(DART_UTILS_INCLUDES_BUILD_TIME
  ${CMAKE_CURRENT_SOURCE_DIR}
  ${CMAKE_CURRENT_BINARY_DIR}
  ${CMAKE_CURRENT_SOURCE_DIR}/utils
  ${DART_UTILS_EXT_INCLUDE_DEPENDENCIES}
  PARENT_SCOPE
)

# Used by config.cmake.install.in
set(DART_UTILS_INCLUDES_INSTALL_TIME
  ${DART_UTILS_INSTALL_INCLUDE_DIR}
  ${DART_UTILS_EXT_INCLUDE_DEPENDENCIES}
  PARENT_SCOPE
)
